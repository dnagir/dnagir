
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Parameterised partials in NHAML – first thought - Art Of Programming</title>
  <meta name="author" content="Dmytrii Nagirniak">

  
  <meta name="description" content="Thinking about parameterised partial views in NHAML. User perspective (view)
How I want to use the partials:
_ TextBox(“FirstName”, “Given Name”) _ &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://ApproachE.com/blog/parameterised-partials-in-nhaml-first">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="http://feeds.feedburner.com/DmitriyNagirnyak" rel="alternate" title="Art Of Programming" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-17928352-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Art Of Programming</a></h1>
  
    <h2>musings by Dmytrii Nagirniak</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="http://feeds.feedburner.com/DmitriyNagirnyak" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:ApproachE.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Home</a></li>
  <li><a href="/about/">About</a></li>
  <li><a href="/blog/archives/">Blog</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Parameterised Partials in NHAML – First Thought</h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-09-04T14:02:00+10:00" pubdate data-updated="true">Sep 4<span>th</span>, 2009</time>
        
      </p>
    
  </header>


<div class="entry-content"><div class='post'>
Thinking about parameterised <a href="http://code.google.com/p/nhaml/issues/detail?id=56" target="_blank">partial views in NHAML</a>.<br />
<h4>
User perspective (view)</h4>
How I want to use the partials:<br />
_ TextBox(“FirstName”, “Given Name”)    <br />_ TextBox(“FirstName”)     <br />_ TextBox<br />
<br />
<h4>
User perspective (partial)</h4>
Define the _TextBox partial:<br />
! (string key, string title=”Provide value:”)    <br />&nbsp; = Html.LabelFor(key).Title(title + variableFromView)     <br />&nbsp; = Html.TextBox(key)<br />
the <b>first line defines set of parameters</b> for the partials. They can be used <b>as regular variables </b>on the partial view and do not intersect in any way with variables on the view. These are <b>local variables only</b>. So we can have integer key variable on the view with value 12345 and string key variable on the partial view with value “partial”. Of course the “partial” value should be the value used in the partial view. Additionally if there are no parameters passed <b>defaults are used</b>.<br />
<br />
<h4>
Requirements</h4>
<ol>
<li>View overrides variables used in outer scope. </li>
<li>View can access outer-scope variables [POTENTIALLY SHOULD AVOID]. </li>
<li>Parameter values have default value if not specified in the actual list of parameters. </li>
<li>Parameter can define a default value which will be used if no value has been provided. </li>
</ol>
<h4>
Implementation thoughts</h4>
To satisfy requirements #1, it seems the partial view should be isolated from the rest of the view processing to be able to handle local variables (In C# it is impossible to have variable with the same name in one method). This behaviour is totally different from the way NHAML works now. Currently any view, partial, partial of partial (of partial…) are executed in one, single scope; generally, sharing all the variables.<br />
To satisfy the requirement #2 we must execute all the partial code in the same scope as the partial view itself. But this won’t satisfy requirement #1.<br />
So at the moment, C# does not allow to implement this at the moment. And as a workaround for this we could discard requirement #2.<br />
The requirements 3 and 4 should not be hard to do.<br />
Possible implementation in meta-code for the <b>NHAML generated code</b> could look like:<br />
<pre class="csharpcode"><span class="rem">// NHAML: _ TextBox("FirstName"), isolating the scope</span>
<span class="kwrd">new</span> NhamlGeneratedPartialTextBox(<span class="kwrd">this</span>).Render(<span class="str">"FirstName"</span>, <span class="str">"Provide value:"</span>);
<span class="rem">// NHAML: _ TextBox</span>
<span class="kwrd">new</span> NhamlGeneratedPartialTextBox(<span class="kwrd">this</span>).Render(<span class="kwrd">default</span>(<span class="kwrd">string</span>), <span class="str">"Provide value:"</span>);</pre>
<style type="text/css">
.csharpcode, .csharpcode pre
{
 font-size: small;
 color: black;
 font-family: consolas, &#8220;Courier New&#8221;, courier, monospace;
 background-color: #ffffff;
 /*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
 background-color: #f4f4f4;
 width: 100%;
 margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<br />
So I would say we can pay the price of not being able to access global variables from partial for the sake of partial parameters.<br />
Also I should mention that the way NHAML works now (joining all the partials into one scope) does not feel good/safe for me. I hit couple of issues with it previously that make my partials strongly bound to the view where they are used. So the <b>partials should be isolated</b>.</div>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Dmytrii Nagirniak</span></span>

      








  


<time datetime="2009-09-04T14:02:00+10:00" pubdate data-updated="true">Sep 4<span>th</span>, 2009</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/development/'>Development</a>, <a class='category' href='/blog/categories/asp-net-mvc/'>asp.net mvc</a>, <a class='category' href='/blog/categories/nhaml/'>nhaml</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://ApproachE.com/blog/parameterised-partials-in-nhaml-first/" data-via="dnagir" data-counturl="http://ApproachE.com/blog/parameterised-partials-in-nhaml-first/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/benefits-of-using-resharper/" title="Previous Post: Benefits of using ReSharper">&laquo; Benefits of using ReSharper</a>
      
      
        <a class="basic-alignment right" href="/blog/prototype-game/" title="next Post: Prototype Game">Prototype Game &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Dmytrii Nagirniak</h1>
  <img src="/about/me.jpg" title="Dmytrii Nagirniak photo" >
  <ul>
    <li>
      <a href="http://twitter.com/dnagir">Twitter</a>
    </li>
    <li>
      <a href="http://github.com/dnagir">Github</a>
    </li>
    <li>
      <a href="http://au.linkedin.com/in/dmitriynagirnyak">LinkedIn</a>
    </li>
    <li>
      <a href="mailto:d@ApproachE.com?subject=Just saying hi">d@ApproachE.com</a>
    </li>
  </ul>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/migrating-from-blogger-to-octopress/">Migrating from Blogger to Octopress</a>
      </li>
    
      <li class="post">
        <a href="/blog/knockoutjs-validations-video/">KnockoutJS Validations Screencast</a>
      </li>
    
      <li class="post">
        <a href="/blog/issues-switching-to-jruby-from-mri-19/">Issues switching to JRuby from MRI 1.9</a>
      </li>
    
      <li class="post">
        <a href="/blog/rails-plugin-with-tested-assets/">Rails Plugin with Tested Assets Screencast</a>
      </li>
    
      <li class="post">
        <a href="/blog/tips-on-usingterminal-in-mac/">Use your Terminal like a Pro</a>
      </li>
    
  </ul>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("dnagir", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/dnagir" class="twitter-follow-button" data-show-count="false">Follow @dnagir</a>
  
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Dmytrii Nagirniak -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'approache';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://ApproachE.com/blog/parameterised-partials-in-nhaml-first/';
        var disqus_url = 'http://ApproachE.com/blog/parameterised-partials-in-nhaml-first/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
