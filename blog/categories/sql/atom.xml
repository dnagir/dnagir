<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: sql | Art Of Programming]]></title>
  <link href="http://ApproachE.com/blog/categories/sql/atom.xml" rel="self"/>
  <link href="http://ApproachE.com/"/>
  <updated>2012-03-10T23:10:59+11:00</updated>
  <id>http://ApproachE.com/</id>
  <author>
    <name><![CDATA[Dmytrii Nagirniak]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Overcoming unavailable RAISERROR in UDF]]></title>
    <link href="http://ApproachE.com/blog/overcoming-unavailable-raiserror-in-udf/"/>
    <updated>2009-06-23T17:50:00+10:00</updated>
    <id>http://ApproachE.com/blog/overcoming-unavailable-raiserror-in-udf</id>
    <content type="html"><![CDATA[<div class='post'>
If you want to indicate an error from UDF first thing you will try (SQL Server) is:<br />
<pre class="csharpcode">RAISERROR(<span class="str">'Invalid argument for MyUDF'</span>, 16, 1)</pre>
<style type="text/css">
.csharpcode, .csharpcode pre
{
 font-size: small;
 color: black;
 font-family: consolas, "Courier New", courier, monospace;
 background-color: #ffffff;
 /*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
 background-color: #f4f4f4;
 width: 100%;
 margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<br />
BUT, this won't work and you will get an error:<br />
<code>Invalid use of 'RAISEERROR' within a function.</code> 

<br />
<br />
This is disappointing (also mention the misspelled RAISE<b>E</b>RROR in the message).<br />
Searching the can bring alternatives.<br />
The simplest one is division by zero:<br />
<pre class="csharpcode"><span class="kwrd">SELECT</span> 1/0</pre>
With this people will remember you for a long time (and not from a good side). PLEASE DO NOT DO IT FOR GOD’S SAKE.<br />
<br />
I choose the one below. It at least allows me to include the error message:<br />
<pre class="csharpcode"><span class="kwrd">SET</span> @<span class="kwrd">dummy</span> = (<span class="kwrd">SELECT</span> <span class="kwrd">CAST</span>((<span class="str">'Invalid argument for MyUDF'</span>) <span class="kwrd">AS</span> <span class="kwrd">INT</span>))</pre>
And will give error message:<br />
<code>Syntax error converting the varchar value 'Invalid argument for MyUDF' to a column of data type int.</code> 

<br />
<br />
Better than division by zero and definitely better than nothing.<br />
Hope this helps.</div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Automatically rollback transaction on error in T-SQL]]></title>
    <link href="http://ApproachE.com/blog/automatically-rollback-transaction-on/"/>
    <updated>2009-06-16T09:54:00+10:00</updated>
    <id>http://ApproachE.com/blog/automatically-rollback-transaction-on</id>
    <content type="html"><![CDATA[<div class='post'>
During any kind of data migration you don’t want to leave any data changed in the middle of migration when an error occurs.<br />
By default Microsoft Sql Server continues batch execution if an error occurs. It skips ONLY the statement with the error.<br />
To make sure it will rollback the transaction use SET <a href="http://msdn.microsoft.com/en-us/library/aa259192%28SQL.80%29.aspx" target="_blank">XACT_ABORT</a> ON before opening a transaction.<br />
Just some stupid example from the top of my head:<br />
<pre class="csharpcode"><span class="kwrd">SET</span> XACT_ABORT <span class="kwrd">ON</span>

<span class="kwrd">BEGIN</span> <span class="kwrd">TRAN</span>

  <span class="kwrd">UPDATE</span> PaymentTax
    <span class="kwrd">SET</span> Amount = p.Amount * 0.1
  <span class="kwrd">FROM</span>
    Payment p, PaymentTax t
  <span class="kwrd">WHERE</span>
    t.PaymentId = p.Id
    <span class="kwrd">AND</span> p.PaymentType = 1 <span class="rem">-- CreditCard</span>

  <span class="rem">-- Do more stuff in-between</span>

  <span class="kwrd">UPDATE</span> Payment
    <span class="kwrd">SET</span> Amount = Amount - Amount*0.1
  <span class="kwrd">WHERE</span> PaymentType=1 <span class="rem">-- CreditCard</span>

<span class="kwrd">COMMIT</span> <span class="kwrd">TRAN</span></pre>
<style type="text/css">
.csharpcode, .csharpcode pre
{
 font-size: small;
 color: black;
 font-family: consolas, "Courier New", courier, monospace;
 background-color: #ffffff;
 /*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
 background-color: #f4f4f4;
 width: 100%;
 margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style><style type="text/css">
.csharpcode, .csharpcode pre
{
 font-size: small;
 color: black;
 font-family: consolas, "Courier New", courier, monospace;
 background-color: #ffffff;
 /*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
 background-color: #f4f4f4;
 width: 100%;
 margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style><style type="text/css">
.csharpcode, .csharpcode pre
{
 font-size: small;
 color: black;
 font-family: consolas, "Courier New", courier, monospace;
 background-color: #ffffff;
 /*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
 background-color: #f4f4f4;
 width: 100%;
 margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<br />
setting the SET XACT_ABORT ON will ensure there will be no possibility of changing Payments’ amount without changing tax.<br />
The XACT_ABORT is available at least since Sql Server 20000 so should be ok if you work with different versions of SqlServer.</div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Enterprise Core Objects – the best news for years]]></title>
    <link href="http://ApproachE.com/blog/enterprise-core-objects-best-news-for/"/>
    <updated>2009-05-15T09:22:00+10:00</updated>
    <id>http://ApproachE.com/blog/enterprise-core-objects-best-news-for</id>
    <content type="html"><![CDATA[<div class='post'>
I use <a href="http://en.wikipedia.org/wiki/CodeGear_ECO" target="_blank">Enterprise Core Objects</a> all the time and I really enjoy it. There’s no other framework in the world like this one (at least I’m not aware of such).<br />
But it has some issues when it comes to SQL. The worst limitation during long time was that most of power of it is supported in-memory. YOu can run any kind of query, but in memory. If you want to execute it in the databases (SQL)… ECO just supports small subset of in-memory operations.<br />
For example, we cannot count number of objects InPs (In-Persistence, on the Database Server) query (Person.allInstances-&gt;size), we cannot use casting (Oreder.allInstances.Transactions-&gt;select( t | t.oclIsTypeOf(Payment))) etc.<br />
<br />
But today my day starts really good because of the <a href="http://www.capableobjects.com/apps/InstantForum414/Topic3015-4-1.aspx#bm3323" target="_blank">response</a> on the forum.<br />
I hope the In-Ps queries will be as powerful as InMemory ones. Time will show…<br />
If it will be implemented ECO querying abilities will be much closer to ones in NHibernate. And I hope it will be more powerful some day (better soon!).<br />
<br />
I like what Jonas said: <br />
<blockquote>
<i>I have initiated work on this.</i></blockquote>
<br />
And:<br />
<blockquote>
<i>I can't promise anything for custom OclPs-operations yet.</i></blockquote>
<br />
I assume the 2nd statement puts ECO far away from NHibernate in querying abilities. Unfortunatelly… Not everything is such bright, but this is still a step forward.</div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[What’s around for last months]]></title>
    <link href="http://ApproachE.com/blog/whats-around-for-last-months/"/>
    <updated>2009-04-09T17:01:00+10:00</updated>
    <id>http://ApproachE.com/blog/whats-around-for-last-months</id>
    <content type="html"><![CDATA[<div class='post'>
I haven’t been blogging for a while and even thought about giving it up. Sometimes I just didn't have time.<br />
But i want to recover a bit and write at least summary of thing I would like to write about.<br />
<br />
For now I’ll just post the summary of the most interesting/exciting thing that happened during last months. So here we go:<br />
<ul>
<li>Official ASP.NET MVC Release. It still has a lot of thing to improve, but I enjoy it. I mean it. I really do. And even wrote my own library with different extensions. Also MvcContrib’s <a href="http://www.jeremyskinner.co.uk/2009/02/08/rewriting-the-mvccontrib-grid/" target="_blank">Grid</a> is pretty exciting now (not very good with paging, filtering, sorting but still).</li>
<li><a href="http://extjs.com/blog/2009/04/04/ext-core-30-beta-released/" target="_blank">Recently release ExtJs Core</a>. This is MIT licensed, cut version of ExtJS (whiGPL-licensed). It supports the DOM manipulations, Ajax, effects etc. Well. everything that any other JavaScript library does. Why I put this here? We need to remember that ExtJS used to <b>L</b>GPL licensed which allowed to deploy it. A lot of <a href="http://extjs.com/forum/showthread.php?t=33096" target="_blank">issues were raised</a> when it became GPL licensed. So they release part of it with very permissive MIT license. Good for those to transfer from old LGPL ExtJS to this one, even if it’s cut down. (I think I would still prefer jQuery instead, they did change license to more strict once, so they can completely make it commercial).</li>
<li>A lot of talks around <a href="http://www.google.com.au/search?q=Google+becomes+evil" target="_blank">Google becomes evil</a> (yep, the link is Google search:)).</li>
<li><a href="http://blog.codeville.net/2009/03/27/first-steps-with-lightweight-test-automation-framework/" target="_blank">Lightweight Test Automation Framework</a>. Wanted to play with it. No time found.</li>
<li>IE8 has been released. Get ready to go and fix all the things on all websites. I don’t like when a new major version of any browser is released :)</li>
<li>Real-life code sample: <a href="http://ayende.com/Blog/archive/2009/03/19/how-not-to-write-a-logger.aspx" target="_blank">How NOT to write a logger</a> (have fun).</li>
<li><a href="http://www.hanselman.com/blog/FreeASPNETMVCEBookNerdDinnercomWalkthrough.aspx" target="_blank">Free ASP.NET MVC Book</a>.</li>
<li><a href="http://www.capableobjects.com/apps/InstantKB13/KnowledgebaseArticle50020.aspx" target="_blank">ECO5</a> gets released soon. It seems there’s still no ability to extend operations executed on the Database Server. Linq2Eco is far from supporting everything that Linq2Sql does. All other is great.</li>
<li>Reminder. ding, ding: <a href="http://www.codinghorror.com/blog/archives/001210.html" target="_blank">Most Dangerous Programming mistakes</a>.</li>
<li><a href="http://blog.codeville.net/2009/01/10/xval-a-validation-framework-for-aspnet-mvc/" target="_blank">xVal</a> – validation framework for MVC. Woth looking at.</li>
<li><a href="http://mrpmorris.blogspot.com/2009/04/my-first-aop_08.html" target="_blank">AOP</a> in Delphi – it’s better than just PostSharp because you can use the Aspects (PostSharp just postcompiles it)</li>
<li>Probably something else…</li>
</ul>
I have been working on a project with Ms Access fron-end and Sql Server back-end. I’ll write another story about it. Can tell in a short that I had a lot of fun (mostly hysterical). Sometimes I hated it, sometimes I loved. Good old client-server DOESN’T suck.<br />
<br />
Now leaving office and going for holidays!<br />
<br />
<b>Happy Easter!</b></div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Comments in MS Access]]></title>
    <link href="http://ApproachE.com/blog/comments-in-ms-access/"/>
    <updated>2009-01-16T10:43:00+11:00</updated>
    <id>http://ApproachE.com/blog/comments-in-ms-access</id>
    <content type="html"><![CDATA[<div class='post'>
It turns out that MS Access 2003 just doesn't support comments in the SQL statement. I never new it because of I didn't use Access much. But it is ridiculous.</div>

]]></content>
  </entry>
  
</feed>
